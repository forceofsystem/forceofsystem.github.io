<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  
  <meta name="author" content="Patrick">

  
  
  <meta name="description" content="‰∏Ä‰∏™ÂàÜ‰∫´ÁîüÊ¥ªÁöÑÂçöÂÆ¢">
  

  
  <link rel="icon" href="https://forceoflife.cn/favicon.jpeg">

  
  
  <meta name="keywords" content=" hugo  latex  theme ">
  

  
  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css"
  integrity="sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
  integrity="sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js"
  integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body, {
      delimiters: [
        { left: '$$', right: '$$', display: true },
        { left: '\\[', right: '\\]', display: true },
        { left: '$', right: '$', display: false },
        { left: '\\(', right: '\\)', display: false }
      ],
      ignoredTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code', 'option'],
      throwOnError: false
    });
  });
</script>


  

  
  <meta property="og:url" content="https://forceoflife.cn/en/post/ctrick/">
  <meta property="og:site_name" content="Force of Life">
  <meta property="og:title" content="How can we use c programming tricks?">
  <meta property="og:description" content="‰∏Ä‰∏™ÂàÜ‰∫´ÁîüÊ¥ªÁöÑÂçöÂÆ¢">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-07-18T00:52:34+08:00">
    <meta property="article:modified_time" content="2024-07-18T00:52:34+08:00">
    <meta property="article:tag" content="C">
    <meta property="article:tag" content="Computer">


  
  <link rel="canonical" href="https://forceoflife.cn/en/post/ctrick/">

  
  
  
  <meta itemprop="name" content="How can we use c programming tricks?">
  <meta itemprop="description" content="‰∏Ä‰∏™ÂàÜ‰∫´ÁîüÊ¥ªÁöÑÂçöÂÆ¢">
  <meta itemprop="datePublished" content="2024-07-18T00:52:34+08:00">
  <meta itemprop="dateModified" content="2024-07-18T00:52:34+08:00">
  <meta itemprop="wordCount" content="402">
  <meta itemprop="keywords" content="C,Computer">

  
  <link media="screen" rel="stylesheet" href='https://forceoflife.cn/css/common.css'>
  <link media="screen" rel="stylesheet" href='https://forceoflife.cn/css/content.css'>

  
  
  <title>How can we use c programming tricks? - Force of Life</title>
  

  
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="How can we use c programming tricks?">
  <meta name="twitter:description" content="‰∏Ä‰∏™ÂàÜ‰∫´ÁîüÊ¥ªÁöÑÂçöÂÆ¢">


  
<link rel="stylesheet" href='https://forceoflife.cn/css/single.css'>

</head>

<body>
  <div id="wrapper">
    <header id="header">
  <h1>
    <a class="head" href="https://forceoflife.cn/">Force of Life</a>
  </h1>

  <nav>
    
    <span class="nav-bar-item">
      <a class="head" href="/en/">Home</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="head" href="/en/post/">Posts</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="head" href="/en/about/">About</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="head" href="/en/index.xml">Subscribe</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="head" href="/zh-cn">‰∏≠Êñá</a>
    </span>
    
  </nav>
</header>

    
<main id="main" class="post">
  
  
  <h1>How can we use c programming tricks?</h1>
  
  <div>
    
    <a class="link keywords" href='https://forceoflife.cn/tags/c'>#C</a>
    
    <a class="link keywords" href='https://forceoflife.cn/tags/computer'>#Computer</a>
    
  </div>
  
  
  
  <details>
    <summary class="toctext">
        <b>Table of Contents</b>
    </summary>
    <div class="toc"><nav id="TableOfContents">
  <ul>
    <li><a href="#background">Background</a></li>
    <li><a href="#the-problem">The Problem</a></li>
  </ul>
</nav></div>
  </details>
  
  
  <article class="content">
    
    <p>Last week, while working on a task involving the <code>core-v binutils</code>, I encountered an interesting case that illustrates how C programming techniques can be effectively applied. However, before talking about the task, I&rsquo;m suppposed to introduce the background.</p>
<h2 id="background">Background</h2>
<p>I believe that all of you are familiar with the follow code:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>i<span style="color:#fe8019">++</span>;
</span></span></code></pre></div><p>, which is called <code>post increment</code>. This code usually appear inner a loop, like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#fe8019">for</span> (<span style="color:#fabd2f">int</span> i <span style="color:#fe8019">=</span> <span style="color:#d3869b">0</span>; i <span style="color:#fe8019">&lt;</span> N; i<span style="color:#fe8019">++</span>) { ... }
</span></span></code></pre></div><p>It&rsquo;s equal to <code>i = i + 1</code>, with which we can eliminate some redundant code:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#928374;font-style:italic">// case 1
</span></span></span><span style="display:flex;"><span><span style="color:#928374;font-style:italic"></span>sum <span style="color:#fe8019">+=</span> <span style="color:#fe8019">*</span>a;
</span></span><span style="display:flex;"><span>a <span style="color:#fe8019">=</span> a <span style="color:#fe8019">+</span> <span style="color:#d3869b">1</span>; <span style="color:#928374;font-style:italic">// redundant!
</span></span></span><span style="display:flex;"><span><span style="color:#928374;font-style:italic">// case 2
</span></span></span><span style="display:flex;"><span><span style="color:#928374;font-style:italic"></span>sum <span style="color:#fe8019">+=</span> <span style="color:#fe8019">*</span>a<span style="color:#fe8019">++</span>; <span style="color:#928374;font-style:italic">// nice
</span></span></span></code></pre></div><p>The second case accomplishes the same task as the first but in a more concise and readable manner, since it merges the two operations into a single line rather than separating it into two. If you are confused to why they do the same work, I recommend you to read <a href="https://en.wikipedia.org/wiki/The_C_Programming_Language">this book</a> at first.</p>
<p>However, although we can merge the memory access operation and the increment operation in the perspective of C, there will also be three instructions in the assembly code.</p>
<pre tabindex="0"><code class="language-assembly" data-lang="assembly">lw  a5, 0(a3)
add a6, a6, a5 // sum = sum + *a;
addi a, a, 4 // a++;
</code></pre><p>Because of the <code>add</code> instruction only receive immediate numbers and registers, the computer need to load it from the memory. But as we talk above, combining the memory access operation and increment operation can not only reduce a program&rsquo;s size, but also improve the instruction-level parallelism, which can speed up the program&rsquo;s execution. Fortunately, <a href="https://www.openhwgroup.org">OpenHW Group</a>&rsquo;s CPU can feed our need. They extend RISC-V 32-bit isa, add some <code>Post-Increment Load &amp; Store</code> instructions. You can go through <a href="https://docs.openhwgroup.org/projects/cv32e40p-user-manual/en/latest/instruction_set_extensions.html#post-increment-load-store-instructions-and-register-register-load-store-instructions">this page</a> to learn the detail. In general, we can use one instructions to access somewhere in memory, and then increment the relevant index.</p>
<pre tabindex="0"><code class="language-assembly" data-lang="assembly">cv.lb rD, (rs1), rs2
</code></pre><p>For example, the above instruction plays the same role with the following:</p>
<pre tabindex="0"><code>rD = Sext(Mem8(rs1))
rs1 += rs2
</code></pre><h2 id="the-problem">The Problem</h2>
<p>In order to test instructions can be generated by the compiler exactly, we always create many test cases to ensure it. However, compilers&rsquo; behaviour is different, which usually depends on the optimization level, such as <code>O1</code>, <code>Og</code> etc. Thus, sometimes the compiler can&rsquo;t generate specific instructions needed by us, for which we need to use some tricks to achieve it.</p>
    
  </article>
  <div class="paginator">
    
    <a class="link" href="https://forceoflife.cn/en/post/concepts/">‚Üê prev</a>
    
    
    <a></a>
    
  </div>
  <div class="comment">
    
    
    
    
      
    
    
    
  </div>
  
</main>

    <footer id="footer">
  <div class="footcontent">
    <span>¬© 2023</span> - <span>2024</span>
  </div>

  <div class="footcontent">
    <span>Powered by </span>
    <a class="footlink" href="https://gohugo.io/">Hugo</a>
    <span> üç¶ Theme </span>
    <a class="footlink" href="https://github.com/forceofsystem/hugo-theme-texify">TeXify</a>
  </div>

  <div class="footnote">
    <span>Follow me on <a class=link href=https://github.com/forceofsystem>GitHub</a> |
<a class=link href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener>CC BY-NC-SA 4.0</a>
</span>
  </div>
</footer>

  </div>

  
  

  
  

  
  
  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-TZC1QJP9DV"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-TZC1QJP9DV');
        }
      </script>
    
  



</body>

</html>
